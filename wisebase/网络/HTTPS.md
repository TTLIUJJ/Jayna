# HTTPS

- 对称加密
有流式、分组两种，加密和解密都是使用同一个秘钥。

- 非对称加密
加密使用的秘钥和解密使用的秘钥是不同的，分别称为公钥和私钥，公钥算法是公开的，私钥的算法是私有的，非对称加密算法性能低，但是安全性超高。
常用的有：RSA、DSA。

- 哈希算法
将任意长度的信息转换成较短的固定长度的值，通常比其长度要小的多，算法不可逆。
常用的有：MD5、SHA-1、SHA-2。

- 数字签名
签名就是在信息的后面再加上一段内容，可以证明信息没有比修改过。Hash值一般都会加密后（也就是签名），再和信息一起发送，以保证这个hash值不比修改。

## 不安全的HTTP

HTTP协议属于明文传输协议，交互过程以及数据传输都没有进行加密，通信双方也没有进行任何认证，通信过程非常容易遭到劫持、监听、篡改、流量劫持和个人隐私泄露等问题。

比如常见的，在HTTP通信过程中，"中间人"将广告链接嵌入HTTP响应报文中，导致用户界面出现了很多不良的链接；或者是修改用户的请求报文，导致用户的请求被劫持到其他网站。


## 安全的HTTPS

- SSL：Secure Socket Layer，安全套接字层
- TLS：Transport Layer Security，安全传输层，前身是SSL，目前广泛使用的TLS 1.1和TLS 1.2



![](http://p5s0bbd0l.bkt.clouddn.com/https0.jpg)

要解决HTTP不安全的问题，需要从两个方面入手：

- 消息加密，如果服务器给客户端的消息是密文的，只有服务器和客户端才能读懂，就可以保证数据的保密性；
- 身份验证机制，在数据交换之前，验证对方的合法身份，就可以保证通信双方的安全。

#### 对称加密

![](http://p5s0bbd0l.bkt.clouddn.com/https3.jpg)

服务器和客户端双方拥有相同搞得秘钥，信息得到安全的传输，中间人不知道秘钥，无法破解，但是此种方法的缺点很明显：

- 不同的客户端、服务器数量庞大，双方都要维护大量的秘钥，维护成本太高
- 安全级别不高，秘钥及其泄露
- 最大的问题是，如何将秘钥同时给客户端和服务端，而不被中间人截获

#### 非对称加密解密

![](http://p5s0bbd0l.bkt.clouddn.com/https1.jpg)

- 秘钥：指的是非对称加解密的秘钥，用于TLS握手阶段
- 对称秘钥：指的是对称加密解密的秘钥，用于数据加解密。

非对称加密解密算法：服务器把公钥发送给客户端，客户端这个公钥来进行数据加密，服务器接收到使用唯一的私钥进行解密。非对称加密可以很好的管理对称秘钥，可以保证每次数据加密的对称秘钥都是不同的。


#### 劫持秘钥

![](http://p5s0bbd0l.bkt.clouddn.com/https2.jpg)

- 中间人在收到服务器发送给客户端的公钥并保存，然后发送一个伪造公钥给客户端；
- 客户端使用伪造公钥进行加密后，将其发送给中间人；
- 中间人利用自己的私钥进行数据解密后，使用正确的公钥加密数据后，发送给服务器；
- 中间人最后把服务器的响应发送给客户端。

此时，客户端和中间人，中间人和服务器都有了一样的对称秘钥，后续客户端和服务器的所有加密数据，中间人都可以通过对称秘钥来破解。

#### 数字证书

CA：Certificate Authority，电子商务认证机构

秘钥被劫持的原因主要在于，客户端和服务器都无法识别经过公钥加密的数据，是否真的来源于对方。

![](http://p5s0bbd0l.bkt.clouddn.com/https4.jpg)


SSL证书包括：

- 证书的发布机构CA
- 证书的有效期
- 公钥
- 证书所有者
- 签名

**工作流程：**

- 客户端首先要内置安装SSL证书，证书的内容包括
- 服务器发送SSL证书给客户端
- 客户端对数字证书进行验证，以客户端浏览器说明
	- 浏览器读取证书中的证书所有者，有效期限等信息进行一一校验
	- 浏览器查找操作系统中已内置的受信任的证书发布机构CA，与接收证书的CA对比
	- 取出证书中的公钥，然后对接收证书中的签名进行解密
	- 浏览器使用相同hash算法计算证书中的hash值，然后与解密的签名进行对比
	- 对比结果一致的话，那证书合法，使用公钥进行后续加密
- 如果验证通过，使用公钥对数据进行加密

使用SSL证书的形式，即解决了公钥的获取问题，又解决了黑客冒充的问题，真正完成了HTTPS的加密传输。

## 总结

 相比于HTTP协议，HTTPS协议增加了更多的握手，加密解密的过程，过程更加复杂，但是可以保证数据传输的安全。
 
 - 所有的数据都是加密的，无法被黑客窃取
 - 配备身份证书，防止身份被冒充
 - 具有校验机制，通信双方都会发现被篡改的数据